<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">

        <link rel="stylesheet" href="../../css/test.css">
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        <title>Cube - {4, 3, 6}</title>
    </head>

    <body>

        <script type="module">

            import * as MAIN from "../../js/main/main-utilities.js";
            import * as THREE from "../../js/three.module.js";

            import { hyperbolicCubeGeometry } from "../../js/geometries/43n-geometry.js";

            import { OrbitControls } from "../../js/orbit-controls.js";
            import * as CONSTANTS from "../../js/main/main-constants.js";

            var view = document.getElementById("view");
            var WIDTH = view.clientWidth;
            var HEIGHT = view.clientHeight;
            var rect = view.getBoundingClientRect();

            // setup scene
            var scene = new THREE.Scene();
            scene.background = new THREE.Color(0xDDDDDD);

            // group of meshes
            var meshes = new THREE.Group();

            // add camera and light to scene
            var camera = new THREE.PerspectiveCamera(70, WIDTH / HEIGHT, 0.1, 100);
            camera.position.set(3, 0, 0);
            camera.updateProjectionMatrix();
            camera.add(new THREE.HemisphereLight(0xaaaaaa, 0x555555));

            scene.add(camera);
            scene.add(new THREE.HemisphereLight(0xcccccc, 0x222222));

            // add the main polyhedron to the scene
            // octahedron
            MAIN.addCellToGroup({
                geometryFunction: hyperbolicCubeGeometry,
                group: meshes,
                metric: "hyperbolic",
                refinement: CONSTANTS.individualDefinition,
                order: 6,
                colour: "#AAD083",
                numberOfFaces: 6,
                name: "{4,3,6}",
                faceMode: true,
                transform: "",
                compact: "paracompact"
            });

            // setup the renderer
            var renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(WIDTH, HEIGHT);
            var intersectionObjectName, intersectionObject, clickObjectParams;

            // add controls to the camera
            var controls = new OrbitControls(camera, renderer.domElement);
            controls.enableZoom = true;
            controls.enabled = true;
            controls.minZoom = 1;
            controls.maxZoom = 5;
            controls.update();


            // add a raycaster to the scene for object selection
            var raycaster = new THREE.Raycaster(), mouseVector = new THREE.Vector2();

            // add the meshes to the scene
            scene.add(meshes);

            // add some event listeners
            window.addEventListener("click", onMouseClick, false);
            window.addEventListener("mousemove", onMouseMove, false);
            window.addEventListener("resize", onWindowResize, false);

            // add the renderer to the 'view' div
            view.appendChild(renderer.domElement);

            render();

            // t is time and is used in rotations
            // click Object is the object clicked by the user
            var t = 0, clickObject = "";

            function render() {

                requestAnimationFrame(render);

                // meshes.children.forEach(element => {
                //     element.rotation.y = t * 0.003;
                //     element.rotation.y = -t * 0.005;
                //     element.rotation.z = -t * 0.007;
                // });
                // t++;

                renderer.render(scene, camera);

            }

            function onMouseClick(event) {

                mouseVector.x = ((event.clientX - rect.left) / WIDTH) * 2 - 1;
                mouseVector.y = - (event.clientY / HEIGHT) * 2 + 1;
                raycaster.setFromCamera(mouseVector, camera);

                var intersects = raycaster.intersectObjects(meshes.children);
                if (intersects.length != 0) {
                    var obj = intersects[0].object;
                    console.log(obj);
                    document.getElementById("content1").innerHTML = obj.cellName + obj.faceName + "d";
                    var colour = new THREE.Color(
                        Math.min(Math.max(obj.material.color.r + (2 * Math.random() - 1) / 10, 0), 1),
                        Math.min(Math.max(obj.material.color.g + (2 * Math.random() - 1) / 10, 0), 1),
                        Math.min(Math.max(obj.material.color.b + (2 * Math.random() - 1) / 10, 0), 1)
                    );
                    document.getElementById("content2").innerHTML = colour.r;
                    MAIN.addCellToGroup({
                        geometryFunction: hyperbolicCubeGeometry,
                        group: meshes,
                        metric: "hyperbolic",
                        refinement: CONSTANTS.individualDefinition,
                        order: 6,
                        colour: "#" + colour.getHexString(),
                        numberOfFaces: 6,
                        name: "{4,3,6}",
                        faceMode: true,
                        transform: obj.cellName + obj.faceName + "d",
                        compact: "paracompact"
                    });
                } else {
                    console.log("empty space");
                    clickObject = null;
                    document.getElementById("content1").innerHTML = "empty space";
                    document.getElementById("content2").innerHTML = "";
                    console.log(document.getElementById("content"));
                }

            }

            function onWindowResize(event) {

                WIDTH = view.clientWidth;
                HEIGHT = view.clientHeight;
                renderer.setSize(WIDTH, HEIGHT);
                camera.aspect = WIDTH / HEIGHT;
                camera.updateProjectionMatrix();

            }

            function onMouseMove(event) {

                event.preventDefault();

                mouseVector.x = ((event.clientX - rect.left) / WIDTH) * 2 - 1;
                mouseVector.y = - (event.clientY / HEIGHT) * 2 + 1;
                raycaster.setFromCamera(mouseVector, camera);

                var intersects = raycaster.intersectObjects(meshes.children);

                if (intersects.length > 0) {
                    var selectedObject = intersects[0].object;
                    if (intersectionObject != selectedObject) {
                        intersectionObject = selectedObject;
                        meshes.children.forEach(mesh => {
                            if (mesh === intersectionObject) {
                                var col = {
                                    r: mesh.material.color.r,
                                    g: mesh.material.color.g,
                                    b: mesh.material.color.b
                                };
                                mesh.material.emissive.setRGB(col.r, col.g, col.b);
                            } else {
                                mesh.material.emissive.setRGB(0, 0, 0);
                            }
                        });
                    }
                } else {
                    meshes.children.forEach(mesh => { mesh.material.emissive.setRGB(0, 0, 0); });
                    intersectionObjectName = null;
                }
            }

        </script>

        <script type="module">

            var dropdown = document.getElementsByClassName("dropdown");
            var i;

            for (i = 0; i < dropdown.length; i++) {
                dropdown[i].addEventListener("mousedown", function () {
                    this.classList.toggle("active");
                    var dropdownContent = this.nextElementSibling;
                    if (dropdownContent.style.display === "block") {
                        dropdownContent.style.display = "none";
                    } else {
                        dropdownContent.style.display = "block";
                    }
                });
            }

        </script>

        <div id="panel">
            <div id="header">
                <h1>
                    <a href="../shape-menagerie.html"> \(s\mathbb{H}ap\mathbb{E}\mathbb{S}\)</a>
                </h1>
            </div>
            <div id="sections">
                <button class="dropdown tetrahedral">
                    Tetrahedral
                </button>
                <div class="tetrahedral opt">
                    <a href="#">\[\{3, 3, 6\}\]</a>
                </div>
                <button class="dropdown cubic">
                    Cubic
                </button>
                <div class="cubic opt">
                    <a href="#">\[\{4, 3, 5\}\]</a>
                    <a href="#">\[\{4, 3, 6\}\]</a>
                </div>
                <button class="dropdown octahedral">
                    Octahedral
                </button>
                <div class="octahedral opt">
                    <a href="#">\[\{3, 4, 4\}\]</a>
                </div>
                <button class="dropdown dodecahedral">
                    Dodecahedral
                </button>
                <div class="dodecahedral opt">
                    <a href="#">\[\{5, 3, 4\}\]</a>
                    <a href="#">\[\{5, 3, 5\}\]</a>
                    <a href="#">\[\{5, 3, 6\}\]</a>
                </div>
                <button class="dropdown icosahedral">
                    Icosahedral
                </button>
                <div class="icosahedral opt">
                    <a href="#">\[\{3, 5, 3\}\]</a>
                </div>
                <button class="dropdown hexagonal">
                    Hexagonal
                </button>
                <div class="hexagonal opt">
                    <a href="#">\[\{6, 3, 3\}\]</a>
                    <a href="#">\[\{6, 3, 4\}\]</a>
                    <a href="#">\[\{6, 3, 5\}\]</a>
                </div>
                <a href="/root/index.html">index</a>

                <div id="content1">
                    Hi
                </div>
                <div id="content2">
                    Hi
                </div>
            </div>
        </div>

        <div id="view">

        </div>

    </body>

</html>
